┌─────────────────────────────────────────────────────────────┐
│                    RESERVATION LIFECYCLE                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│   BOOKED     │───▶│  CHECKED_IN  │───▶│ IN_SERVICE   │
└──────────────┘    └──────────────┘    └──────────────┘
                                                │
                                                ▼
                                         ┌──────────────┐
                                         │  COMPLETED   │
                                         └──────────────┘
                                                │
                                                ▼
                                         ┌──────────────┐
                                         │ CHECKED_OUT  │
                                         └──────────────┘
                                                │
                              ┌─────────────────┴─────────────────┐
                              ▼                                   ▼
                    ┌──────────────────┐              ┌─────────────────┐
                    │ CREATE INVOICE   │              │ MARK ROOM DIRTY │
                    └──────────────────┘              └─────────────────┘
                              │                                   │
                              ▼                                   ▼
                    ┌──────────────────┐              ┌─────────────────┐
                    │  Invoice Record  │              │ HK Task Created │
                    │  - Items         │              └─────────────────┘
                    │  - Totals        │
                    │  - Status:       │
                    │    'pending'     │
                    └──────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     PAYMENT PROCESSING                       │
└─────────────────────────────────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
   ┌────────────┐      ┌────────────┐     ┌────────────┐
   │   FULL     │      │  PARTIAL   │     │  DEPOSIT   │
   │  PAYMENT   │      │  PAYMENT   │     │  PAYMENT   │
   └────────────┘      └────────────┘     └────────────┘
          │                   │                   │
          └───────────────────┼───────────────────┘
                              ▼
                    ┌──────────────────┐
                    │  Payment Record  │
                    │  - Amount        │
                    │  - Method        │
                    │  - Status        │
                    └──────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
   ┌─────────────┐   ┌──────────────┐   ┌─────────────┐
   │   Update    │   │   Update     │   │   Update    │
   │   Invoice   │   │    Guest     │   │   Loyalty   │
   │   Totals    │   │  Statistics  │   │   Points    │
   └─────────────┘   └──────────────┘   └─────────────┘